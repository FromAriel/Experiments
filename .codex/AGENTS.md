🧠 Codex Agent Workspace Tooling Contract and Guide
Godot 4.4.1 · Headless Environment · CI Safe · Mono/.NET Included

[!IMPORTANT]
Indentation: Always use 4 spaces in .gd, .gdshader, and .cs files. Never use tabs.
gdlint wants 'class_name' before 'extends'

🚦 First-Time Setup & Validation (Headless, No GUI Needed)
When you clone or open this Godot 4.4.1 (Mono/.NET) project for the first time:

Use the Godot editor binary (not export template) with CLI flags.

Must include editor tools and .NET support.

If godot is not on your $PATH, set the GODOT environment variable to the full binary path.

Refresh project caches and import all assets:


$GODOT --headless --editor --import --quit --path .
Generates .godot/global_script_class_cache.cfg and imports all assets (GDScript and C# included).

Parse every GDScript file and quit on error:


$GODOT --headless --check-only --quit --path .
Compiles/parses all .gd files; exits non-zero if any errors are found.

Build and check all C#/.NET code:


dotnet build > /tmp/dotnet_build.log
tail -n 20 /tmp/dotnet_build.log
This step must succeed (exit code 0) and produce no errors in the log.

Interpret the results:

Exit code 0: All scripts and C# code parsed and built cleanly; project is “clean.”

Non-zero exit: There are GDScript, C#, or asset errors. Parse the output lines:

GDScript errors: res://path/file.gd:<line>:<column>: error: ...

C# errors: Standard MSBuild output, e.g. /path/to/File.cs(17,13): error ...

Use this info to locate and fix the broken files.

Repeat as needed:
After any codegen or manual edit, repeat all commands until every check and build passes (exit code 0).

🧼 1. Patch Hygiene & Formatting
Indentation: Always use 4 spaces in .gd, .gdshader, and .cs files. Never use tabs.

Before every commit:


.codex/fix_indent.sh $(git diff --name-only --cached -- '*.gd')
# For C#, run: dotnet format (optional)
dotnet format --verify-no-changes || { echo "C# code style violations detected."; exit 1; }
Do NOT commit with tabs, missing indentation, or syntax errors.

🧪 2. Script & Code Validation (Always Headless)
Before every commit or after file edits:


$GODOT --headless --editor --import --quit --path .
$GODOT --headless --check-only --quit --path .
dotnet build > /tmp/dotnet_build.log
tail -n 20 /tmp/dotnet_build.log
All must exit 0.

First Godot step ensures imports and caches are fresh.

Second Godot step parses all GDScripts.

Dotnet build validates and compiles all C#.

Optional: run tests if present:


$GODOT --headless --verbose --no-window -s res://tests/run_all.gd
dotnet test  # If C# unit tests exist
✅ Codex Prompt Quick Checklist


apply_patch
→ gdformat --use-spaces=4 <changed.gd>
→ godot --headless --editor --import --quit --path .
→ godot --headless --check-only --quit --path .
→ dotnet build > /tmp/dotnet_build.log
→ tail -n 20 /tmp/dotnet_build.log
→ ✅ no syntax/C# errors? commit allowed
→ 🚫 error? block patch + show error

🔬 Why This Matters
Godot’s .gd and .cs scripts and dependencies require the internal .godot/global_script_class_cache.cfg generated by the import step.

--check-only validates GDScript, but C# code must also compile without error using dotnet build.

This guarantees full project validation on any headless/clean machine/CI, without GUI.

In summary:

To check if a newly-cloned Godot project “compiles” (parses and builds) without opening the GUI, always run the above headless commands. If all return exit code 0, you’re good. Otherwise, use the output to fix errors, then repeat.

